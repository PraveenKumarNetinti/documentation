---
title: "User Identity & Profile Management"
description: "This phase establishes the user identity system, which is critical for authentication (Phase 4) and authorization (Phase 5). We'll create a robust custom User model, comprehensive profiles, organization memberships, and team structures."
---

## Directory Structure

```
users/
├── __init__.py
├── apps.py
├── models/
│   ├── __init__.py
│   ├── user.py                  # Core user model
│   ├── profile.py               # User profile & preferences
│   ├── membership.py            # Organization membership
│   ├── team.py                  # Teams & departments
│   ├── contact.py               # Contact information
│   ├── employment.py            # Employment details
│   └── social.py                # Social profiles & links
├── managers/
│   ├── __init__.py
│   └── user.py                  # Custom user managers
├── services/
│   ├── __init__.py
│   ├── provisioning.py          # User provisioning
│   └── deactivation.py          # User deactivation/deletion
├── validators/
│   ├── __init__.py
│   └── user.py                  # User-specific validators
└── constants.py                 # User-specific constants
```

---

## 1. User Constants

**File: `users/constants.py`**

```python
"""
Constants specific to user management.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _


class UserStatus(models.TextChoices):
    """User account status."""
    PENDING_VERIFICATION = 'pending_verification', _('Pending Verification')
    ACTIVE = 'active', _('Active')
    INACTIVE = 'inactive', _('Inactive')
    SUSPENDED = 'suspended', _('Suspended')
    DEACTIVATED = 'deactivated', _('Deactivated')
    LOCKED = 'locked', _('Locked')
    ARCHIVED = 'archived', _('Archived')


class MembershipStatus(models.TextChoices):
    """Organization membership status."""
    PENDING = 'pending', _('Pending Acceptance')
    ACTIVE = 'active', _('Active')
    SUSPENDED = 'suspended', _('Suspended')
    INACTIVE = 'inactive', _('Inactive')
    LEFT = 'left', _('Left Organization')


class MembershipRole(models.TextChoices):
    """Basic membership roles (detailed RBAC in Phase 5)."""
    OWNER = 'owner', _('Owner')
    ADMIN = 'admin', _('Administrator')
    MEMBER = 'member', _('Member')
    GUEST = 'guest', _('Guest')


class TeamType(models.TextChoices):
    """Types of teams."""
    DEPARTMENT = 'department', _('Department')
    PROJECT = 'project', _('Project Team')
    WORKING_GROUP = 'working_group', _('Working Group')
    CUSTOM = 'custom', _('Custom')


class EmploymentType(models.TextChoices):
    """Employment type."""
    FULL_TIME = 'full_time', _('Full-time')
    PART_TIME = 'part_time', _('Part-time')
    CONTRACT = 'contract', _('Contract')
    INTERN = 'intern', _('Intern')
    CONSULTANT = 'consultant', _('Consultant')
    VOLUNTEER = 'volunteer', _('Volunteer')


class SocialProvider(models.TextChoices):
    """Social profile providers."""
    GITHUB = 'github', _('GitHub')
    GITLAB = 'gitlab', _('GitLab')
    LINKEDIN = 'linkedin', _('LinkedIn')
    TWITTER = 'twitter', _('Twitter/X')
    FACEBOOK = 'facebook', _('Facebook')
    SLACK = 'slack', _('Slack')
    DISCORD = 'discord', _('Discord')
    CUSTOM = 'custom', _('Custom')


class NotificationChannel(models.TextChoices):
    """Notification delivery channels."""
    EMAIL = 'email', _('Email')
    SMS = 'sms', _('SMS')
    PUSH = 'push', _('Push Notification')
    IN_APP = 'in_app', _('In-App')
    SLACK = 'slack', _('Slack')
    WEBHOOK = 'webhook', _('Webhook')


class UserActivityType(models.TextChoices):
    """Types of user activities."""
    LOGIN = 'login', _('Login')
    LOGOUT = 'logout', _('Logout')
    PASSWORD_CHANGE = 'password_change', _('Password Change')
    PASSWORD_RESET = 'password_reset', _('Password Reset')
    EMAIL_CHANGE = 'email_change', _('Email Change')
    PROFILE_UPDATE = 'profile_update', _('Profile Update')
    MFA_ENABLED = 'mfa_enabled', _('MFA Enabled')
    MFA_DISABLED = 'mfa_disabled', _('MFA Disabled')
    API_KEY_CREATED = 'api_key_created', _('API Key Created')
    API_KEY_REVOKED = 'api_key_revoked', _('API Key Revoked')


# User limits
MAX_ORGANIZATIONS_PER_USER = 50  # Maximum orgs a user can be part of
MAX_TEAMS_PER_USER = 100  # Maximum teams per user
USERNAME_MIN_LENGTH = 3
USERNAME_MAX_LENGTH = 30
```

---

## 2. Custom User Model

**File: `users/models/user.py`**

```python
"""
Core custom user model.
Extends Django's AbstractBaseUser for maximum flexibility.
"""

import uuid
from django.db import models
from django.contrib.auth.models import AbstractBaseUser, PermissionsMixin
from django.core.validators import MinLengthValidator, RegexValidator
from django.utils.translation import gettext_lazy as _
from django.utils import timezone

from core.models import UUIDPrimaryKeyMixin, SoftDeleteMixin
from core.models.fields import CaseInsensitiveEmailField, CaseInsensitiveCharField
from core.validators import validate_no_sql_injection, validate_no_xss
from users.constants import UserStatus, USERNAME_MIN_LENGTH, USERNAME_MAX_LENGTH
from users.managers.user import UserManager


class User(UUIDPrimaryKeyMixin, AbstractBaseUser, PermissionsMixin, SoftDeleteMixin):
    """
    Custom user model with enhanced security and multi-tenancy support.
    
    Core features:
    - UUID primary key
    - Case-insensitive email and username
    - Soft deletion
    - Enhanced status management
    - Multi-organization support
    - Security tracking
    """
    
    # Basic Identity
    username = CaseInsensitiveCharField(
        max_length=USERNAME_MAX_LENGTH,
        unique=True,
        db_index=True,
        validators=[
            MinLengthValidator(USERNAME_MIN_LENGTH),
            RegexValidator(
                regex=r'^[a-zA-Z0-9_-]+$',
                message=_('Username can only contain letters, numbers, underscores, and hyphens.')
            ),
            validate_no_sql_injection,
            validate_no_xss,
        ],
        help_text=_("Unique username for login")
    )
    
    email = CaseInsensitiveEmailField(
        unique=True,
        db_index=True,
        help_text=_("Primary email address")
    )
    
    email_verified = models.BooleanField(
        default=False,
        db_index=True,
        help_text=_("Whether email is verified")
    )
    
    email_verified_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When email was verified")
    )
    
    # Personal Information
    first_name = models.CharField(
        max_length=150,
        validators=[validate_no_sql_injection, validate_no_xss]
    )
    
    last_name = models.CharField(
        max_length=150,
        validators=[validate_no_sql_injection, validate_no_xss]
    )
    
    display_name = models.CharField(
        max_length=255,
        blank=True,
        help_text=_("Preferred display name (defaults to first + last)")
    )
    
    # Status
    status = models.CharField(
        max_length=30,
        choices=UserStatus.choices,
        default=UserStatus.PENDING_VERIFICATION,
        db_index=True,
        help_text=_("Current account status")
    )
    
    status_reason = models.TextField(
        blank=True,
        help_text=_("Reason for current status")
    )
    
    status_changed_at = models.DateTimeField(
        auto_now_add=True,
        help_text=_("When status last changed")
    )
    
    # Permissions
    is_staff = models.BooleanField(
        default=False,
        help_text=_("Can access Django admin site")
    )
    
    is_superuser = models.BooleanField(
        default=False,
        help_text=_("Has all permissions without explicit assignment")
    )
    
    is_active = models.BooleanField(
        default=True,
        db_index=True,
        help_text=_("User can log in")
    )
    
    # System User (for automation, integrations)
    is_system_user = models.BooleanField(
        default=False,
        help_text=_("System/service account")
    )
    
    # Important Dates
    date_joined = models.DateTimeField(
        default=timezone.now,
        db_index=True,
        help_text=_("When user first joined the platform")
    )
    
    last_login = models.DateTimeField(
        null=True,
        blank=True,
        db_index=True,
        help_text=_("Last successful login")
    )
    
    last_activity_at = models.DateTimeField(
        null=True,
        blank=True,
        db_index=True,
        help_text=_("Last activity timestamp")
    )
    
    password_changed_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When password was last changed")
    )
    
    deactivated_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When account was deactivated")
    )
    
    # Security
    login_attempts = models.PositiveIntegerField(
        default=0,
        help_text=_("Failed login attempts counter")
    )
    
    locked_until = models.DateTimeField(
        null=True,
        blank=True,
        db_index=True,
        help_text=_("Account locked until this time")
    )
    
    force_password_change = models.BooleanField(
        default=False,
        help_text=_("Require password change on next login")
    )
    
    # MFA (Multi-Factor Authentication)
    mfa_enabled = models.BooleanField(
        default=False,
        db_index=True,
        help_text=_("MFA is enabled for this user")
    )
    
    mfa_enabled_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When MFA was enabled")
    )
    
    # Locale & Preferences
    language = models.CharField(
        max_length=10,
        default='en',
        help_text=_("Preferred language code")
    )
    
    timezone = models.CharField(
        max_length=50,
        default='UTC',
        help_text=_("User's timezone")
    )
    
    # Privacy
    accept_terms_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When user accepted terms of service")
    )
    
    accept_privacy_at = models.DateTimeField(
        null=True,
        blank=True,
        help_text=_("When user accepted privacy policy")
    )
    
    marketing_consent = models.BooleanField(
        default=False,
        help_text=_("Consented to marketing communications")
    )
    
    marketing_consent_at = models.DateTimeField(
        null=True,
        blank=True
    )
    
    # Tracking
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    # IP Tracking (for security)
    last_login_ip = models.GenericIPAddressField(
        null=True,
        blank=True,
        help_text=_("IP address of last login")
    )
    
    registration_ip = models.GenericIPAddressField(
        null=True,
        blank=True,
        help_text=_("IP address at registration")
    )
    
    # Metadata
    metadata = models.JSONField(
        default=dict,
        blank=True,
        help_text=_("Additional user metadata")
    )
    
    # Django Auth Fields
    USERNAME_FIELD = 'email'
    EMAIL_FIELD = 'email'
    REQUIRED_FIELDS = ['username', 'first_name', 'last_name']
    
    # Custom manager
    objects = UserManager()
    
    class Meta:
        verbose_name = _("User")
        verbose_name_plural = _("Users")
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['email']),
            models.Index(fields=['username']),
            models.Index(fields=['status']),
            models.Index(fields=['is_active', 'email_verified']),
            models.Index(fields=['last_login']),
            models.Index(fields=['date_joined']),
            models.Index(fields=['mfa_enabled']),
        ]
        
    def __str__(self):
        return self.get_full_name() or self.email
    
    def save(self, *args, **kwargs):
        """Override save to set display name and track password changes."""
        # Auto-generate display name
        if not self.display_name:
            self.display_name = self.get_full_name()
        
        # Track password changes
        if self.pk:
            old_user = User.objects.filter(pk=self.pk).first()
            if old_user and old_user.password != self.password:
                self.password_changed_at = timezone.now()
                self.force_password_change = False
        
        super().save(*args, **kwargs)
    
    def get_full_name(self):
        """Return full name."""
        return f"{self.first_name} {self.last_name}".strip()
    
    def get_short_name(self):
        """Return short name."""
        return self.first_name
    
    @property
    def is_verified(self):
        """Check if user has verified their email."""
        return self.email_verified
    
    @property
    def is_locked(self):
        """Check if account is locked."""
        if self.locked_until:
            return timezone.now() < self.locked_until
        return False
    
    @property
    def can_login(self):
        """Check if user can log in."""
        return (
            self.is_active and
            not self.is_deleted and
            not self.is_locked and
            self.status in [UserStatus.ACTIVE, UserStatus.PENDING_VERIFICATION]
        )
    
    def activate(self):
        """Activate user account."""
        self.status = UserStatus.ACTIVE
        self.is_active = True
        self.status_changed_at = timezone.now()
        self.save()
    
    def deactivate(self, reason=""):
        """Deactivate user account."""
        self.status = UserStatus.DEACTIVATED
        self.is_active = False
        self.status_reason = reason
        self.deactivated_at = timezone.now()
        self.status_changed_at = timezone.now()
        self.save()
    
    def suspend(self, reason=""):
        """Suspend user account."""
        self.status = UserStatus.SUSPENDED
        self.is_active = False
        self.status_reason = reason
        self.status_changed_at = timezone.now()
        self.save()
    
    def lock(self, duration_minutes=15):
        """Lock account temporarily."""
        self.locked_until = timezone.now() + timezone.timedelta(minutes=duration_minutes)
        self.status = UserStatus.LOCKED
        self.save()
    
    def unlock(self):
        """Unlock account."""
        self.locked_until = None
        self.login_attempts = 0
        if self.status == UserStatus.LOCKED:
            self.status = UserStatus.ACTIVE
        self.save()
    
    def verify_email(self):
        """Mark email as verified."""
        self.email_verified = True
        self.email_verified_at = timezone.now()
        if self.status == UserStatus.PENDING_VERIFICATION:
            self.status = UserStatus.ACTIVE
        self.save()
    
    def record_login(self, ip_address=None):
        """Record successful login."""
        self.last_login = timezone.now()
        self.last_activity_at = timezone.now()
        self.login_attempts = 0
        if ip_address:
            self.last_login_ip = ip_address
        self.save()
    
    def record_failed_login(self, max_attempts=5):
        """Record failed login attempt."""
        self.login_attempts += 1
        if self.login_attempts >= max_attempts:
            self.lock()
        else:
            self.save()
    
    def update_activity(self):
        """Update last activity timestamp."""
        self.last_activity_at = timezone.now()
        self.save(update_fields=['last_activity_at'])


class UserVerification(models.Model):
    """
    Email and phone verification tokens.
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='verifications'
    )
    
    VERIFICATION_TYPE_CHOICES = [
        ('email', _('Email Verification')),
        ('phone', _('Phone Verification')),
        ('email_change', _('Email Change Verification')),
        ('password_reset', _('Password Reset')),
    ]
    
    verification_type = models.CharField(
        max_length=20,
        choices=VERIFICATION_TYPE_CHOICES
    )
    
    token = models.CharField(
        max_length=255,
        unique=True,
        db_index=True
    )
    
    # For email change verification
    new_email = models.EmailField(blank=True)
    
    # For phone verification
    new_phone = models.CharField(max_length=20, blank=True)
    
    code = models.CharField(
        max_length=10,
        blank=True,
        help_text=_("Short verification code for phone/email")
    )
    
    created_at = models.DateTimeField(auto_now_add=True)
    expires_at = models.DateTimeField(db_index=True)
    
    is_used = models.BooleanField(default=False)
    used_at = models.DateTimeField(null=True, blank=True)
    
    attempts = models.PositiveIntegerField(
        default=0,
        help_text=_("Number of verification attempts")
    )
    
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    
    class Meta:
        verbose_name = _("User Verification")
        verbose_name_plural = _("User Verifications")
        indexes = [
            models.Index(fields=['token']),
            models.Index(fields=['user', 'verification_type']),
            models.Index(fields=['expires_at', 'is_used']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.verification_type}"
    
    @property
    def is_expired(self):
        """Check if verification has expired."""
        return timezone.now() > self.expires_at
    
    @property
    def is_valid(self):
        """Check if verification is valid."""
        return not self.is_used and not self.is_expired
    
    def mark_used(self):
        """Mark verification as used."""
        self.is_used = True
        self.used_at = timezone.now()
        self.save()


class UserActivity(models.Model):
    """
    Track important user activities for audit and security.
    """
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='activities'
    )
    
    activity_type = models.CharField(
        max_length=50,
        db_index=True
    )
    
    description = models.TextField(blank=True)
    
    # Context
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    user_agent = models.TextField(blank=True)
    
    # Location (optional, can be derived from IP)
    city = models.CharField(max_length=100, blank=True)
    country = models.CharField(max_length=2, blank=True)
    
    # Device info
    device_type = models.CharField(
        max_length=20,
        blank=True,
        choices=[
            ('desktop', _('Desktop')),
            ('mobile', _('Mobile')),
            ('tablet', _('Tablet')),
            ('other', _('Other')),
        ]
    )
    
    browser = models.CharField(max_length=50, blank=True)
    os = models.CharField(max_length=50, blank=True)
    
    # Metadata
    metadata = models.JSONField(default=dict, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)
    
    class Meta:
        verbose_name = _("User Activity")
        verbose_name_plural = _("User Activities")
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['user', 'activity_type']),
            models.Index(fields=['created_at']),
            models.Index(fields=['ip_address']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.activity_type}"
```

---

## 3. User Profile

**File: `users/models/profile.py`**

```python
"""
User profile and preferences models.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _
from django.contrib.postgres.fields import ArrayField

from core.models import BaseModel


class UserProfile(BaseModel):
    """
    Extended user profile information.
    One-to-one with User model.
    """
    
    user = models.OneToOneField(
        'User',
        on_delete=models.CASCADE,
        related_name='profile'
    )
    
    # Personal Details
    middle_name = models.CharField(max_length=150, blank=True)
    
    preferred_name = models.CharField(
        max_length=100,
        blank=True,
        help_text=_("How you'd like to be addressed")
    )
    
    pronouns = models.CharField(
        max_length=50,
        blank=True,
        help_text=_("Preferred pronouns (e.g., he/him, she/her, they/them)")
    )
    
    date_of_birth = models.DateField(
        null=True,
        blank=True,
        help_text=_("Date of birth")
    )
    
    # Bio & About
    bio = models.TextField(
        blank=True,
        max_length=500,
        help_text=_("Short biography")
    )
    
    headline = models.CharField(
        max_length=200,
        blank=True,
        help_text=_("Professional headline")
    )
    
    # Contact Information (primary contact in User model)
    phone = models.CharField(
        max_length=20,
        blank=True,
        help_text=_("Primary phone number")
    )
    
    phone_verified = models.BooleanField(default=False)
    
    secondary_email = models.EmailField(
        blank=True,
        help_text=_("Alternative email address")
    )
    
    # Location
    address_line_1 = models.CharField(max_length=255, blank=True)
    address_line_2 = models.CharField(max_length=255, blank=True)
    city = models.CharField(max_length=100, blank=True)
    state_province = models.CharField(max_length=100, blank=True)
    postal_code = models.CharField(max_length=20, blank=True)
    country = models.CharField(max_length=2, blank=True)  # ISO 3166-1 alpha-2
    
    # Profile Media
    avatar_url = models.URLField(
        blank=True,
        help_text=_("Profile picture URL")
    )
    
    cover_image_url = models.URLField(
        blank=True,
        help_text=_("Cover/banner image URL")
    )
    
    # Professional
    job_title = models.CharField(max_length=200, blank=True)
    department = models.CharField(max_length=100, blank=True)
    company = models.CharField(max_length=200, blank=True)
    
    # Skills & Interests
    skills = ArrayField(
        models.CharField(max_length=100),
        default=list,
        blank=True,
        help_text=_("List of skills")
    )
    
    interests = ArrayField(
        models.CharField(max_length=100),
        default=list,
        blank=True,
        help_text=_("List of interests")
    )
    
    # Emergency Contact
    emergency_contact_name = models.CharField(max_length=255, blank=True)
    emergency_contact_phone = models.CharField(max_length=20, blank=True)
    emergency_contact_relationship = models.CharField(max_length=100, blank=True)
    
    # Visibility Settings
    profile_visibility = models.CharField(
        max_length=20,
        default='public',
        choices=[
            ('public', _('Public')),
            ('organization', _('Organization Only')),
            ('private', _('Private')),
        ]
    )
    
    show_email = models.BooleanField(
        default=False,
        help_text=_("Show email in public profile")
    )
    
    show_phone = models.BooleanField(
        default=False,
        help_text=_("Show phone in public profile")
    )
    
    # Metadata
    custom_fields = models.JSONField(
        default=dict,
        blank=True,
        help_text=_("Custom profile fields")
    )
    
    class Meta:
        verbose_name = _("User Profile")
        verbose_name_plural = _("User Profiles")
    
    def __str__(self):
        return f"Profile for {self.user.email}"
    
    @property
    def full_location(self):
        """Get formatted full location."""
        parts = [
            self.city,
            self.state_province,
            self.country
        ]
        return ', '.join(filter(None, parts))


class UserPreferences(BaseModel):
    """
    User application preferences.
    """
    
    user = models.OneToOneField(
        'User',
        on_delete=models.CASCADE,
        related_name='preferences'
    )
    
    # Appearance
    theme = models.CharField(
        max_length=20,
        default='system',
        choices=[
            ('light', _('Light')),
            ('dark', _('Dark')),
            ('system', _('System Default')),
        ]
    )
    
    color_scheme = models.CharField(
        max_length=20,
        default='default',
        help_text=_("Preferred color scheme")
    )
    
    # Notifications
    email_notifications = models.BooleanField(default=True)
    push_notifications = models.BooleanField(default=True)
    sms_notifications = models.BooleanField(default=False)
    desktop_notifications = models.BooleanField(default=True)
    
    # Notification Types
    notify_mentions = models.BooleanField(default=True)
    notify_comments = models.BooleanField(default=True)
    notify_assignments = models.BooleanField(default=True)
    notify_updates = models.BooleanField(default=True)
    notify_reminders = models.BooleanField(default=True)
    notify_newsletter = models.BooleanField(default=False)
    
    # Digest Preferences
    email_digest_frequency = models.CharField(
        max_length=20,
        default='daily',
        choices=[
            ('realtime', _('Real-time')),
            ('hourly', _('Hourly')),
            ('daily', _('Daily')),
            ('weekly', _('Weekly')),
            ('never', _('Never')),
        ]
    )
    
    # Display Preferences
    items_per_page = models.PositiveIntegerField(
        default=25,
        choices=[(10, '10'), (25, '25'), (50, '50'), (100, '100')]
    )
    
    default_view = models.CharField(
        max_length=20,
        default='list',
        choices=[
            ('list', _('List')),
            ('grid', _('Grid')),
            ('board', _('Board')),
        ]
    )
    
    # Regional Settings
    date_format = models.CharField(
        max_length=20,
        default='YYYY-MM-DD'
    )
    
    time_format = models.CharField(
        max_length=10,
        default='24h',
        choices=[
            ('12h', '12-hour'),
            ('24h', '24-hour'),
        ]
    )
    
    week_starts_on = models.CharField(
        max_length=10,
        default='monday',
        choices=[
            ('sunday', _('Sunday')),
            ('monday', _('Monday')),
            ('saturday', _('Saturday')),
        ]
    )
    
    # Privacy
    show_online_status = models.BooleanField(default=True)
    show_activity_status = models.BooleanField(default=True)
    allow_indexing = models.BooleanField(
        default=True,
        help_text=_("Allow search engines to index your profile")
    )
    
    # Accessibility
    high_contrast = models.BooleanField(default=False)
    reduce_motion = models.BooleanField(default=False)
    screen_reader_mode = models.BooleanField(default=False)
    keyboard_shortcuts_enabled = models.BooleanField(default=True)
    
    # Advanced
    developer_mode = models.BooleanField(
        default=False,
        help_text=_("Enable developer features")
    )
    
    beta_features = models.BooleanField(
        default=False,
        help_text=_("Opt into beta features")
    )
    
    # Custom preferences
    custom_preferences = models.JSONField(
        default=dict,
        blank=True
    )
    
    class Meta:
        verbose_name = _("User Preferences")
        verbose_name_plural = _("User Preferences")
    
    def __str__(self):
        return f"Preferences for {self.user.email}"
```

---

## 4. Organization Membership

**File: `users/models/membership.py`**

```python
"""
Organization membership models.
Links users to organizations with roles and permissions.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _
from django.utils import timezone

from core.models import TenantModel
from users.constants import MembershipStatus, MembershipRole


class OrganizationMembership(TenantModel):
    """
    User membership in an organization.
    Many-to-many relationship between Users and Organizations.
    """
    
    # Note: tenant field inherited from TenantModel references Organization
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='memberships',
        db_index=True
    )
    
    # Basic membership info
    status = models.CharField(
        max_length=20,
        choices=MembershipStatus.choices,
        default=MembershipStatus.ACTIVE,
        db_index=True
    )
    
    # Basic role (detailed RBAC in Phase 5)
    base_role = models.CharField(
        max_length=20,
        choices=MembershipRole.choices,
        default=MembershipRole.MEMBER,
        db_index=True,
        help_text=_("Basic membership role")
    )
    
    # Primary/Default Organization
    is_default = models.BooleanField(
        default=False,
        db_index=True,
        help_text=_("User's default organization")
    )
    
    # Dates
    joined_at = models.DateTimeField(
        auto_now_add=True,
        db_index=True
    )
    
    invited_by = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='invited_memberships',
        help_text=_("Who invited this user")
    )
    
    invitation = models.ForeignKey(
        'tenants.OrganizationInvitation',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='accepted_memberships'
    )
    
    suspended_at = models.DateTimeField(null=True, blank=True)
    left_at = models.DateTimeField(null=True, blank=True)
    
    # Access
    last_accessed_at = models.DateTimeField(
        null=True,
        blank=True,
        db_index=True,
        help_text=_("Last time user accessed this organization")
    )
    
    access_count = models.PositiveIntegerField(
        default=0,
        help_text=_("Number of times accessed")
    )
    
    # Job/Position (within this organization)
    job_title = models.CharField(max_length=200, blank=True)
    department = models.CharField(max_length=100, blank=True)
    manager = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='managed_members',
        help_text=_("User's manager in this organization")
    )
    
    # Custom Fields
    custom_fields = models.JSONField(
        default=dict,
        blank=True,
        help_text=_("Organization-specific custom fields")
    )
    
    # Metadata
    notes = models.TextField(
        blank=True,
        help_text=_("Internal notes about this membership")
    )
    
    class Meta:
        verbose_name = _("Organization Membership")
        verbose_name_plural = _("Organization Memberships")
        unique_together = [
            ('tenant', 'user'),
        ]
        indexes = [
            models.Index(fields=['tenant', 'user']),
            models.Index(fields=['user', 'is_default']),
            models.Index(fields=['tenant', 'status']),
            models.Index(fields=['tenant', 'base_role']),
            models.Index(fields=['joined_at']),
        ]
    
    def __str__(self):
        return f"{self.user.email} in {self.tenant.name}"
    
    def save(self, *args, **kwargs):
        """Ensure only one default membership per user."""
        if self.is_default:
            OrganizationMembership.objects.filter(
                user=self.user,
                is_default=True
            ).exclude(pk=self.pk).update(is_default=False)
        
        super().save(*args, **kwargs)
    
    def activate(self):
        """Activate membership."""
        self.status = MembershipStatus.ACTIVE
        self.save()
    
    def suspend(self):
        """Suspend membership."""
        self.status = MembershipStatus.SUSPENDED
        self.suspended_at = timezone.now()
        self.save()
    
    def mark_left(self):
        """Mark as left organization."""
        self.status = MembershipStatus.LEFT
        self.left_at = timezone.now()
        self.save()
    
    def record_access(self):
        """Record organization access."""
        self.last_accessed_at = timezone.now()
        self.access_count += 1
        self.save(update_fields=['last_accessed_at', 'access_count'])
    
    @property
    def is_active(self):
        """Check if membership is active."""
        return self.status == MembershipStatus.ACTIVE
    
    @property
    def is_owner(self):
        """Check if user is organization owner."""
        return self.base_role == MembershipRole.OWNER
    
    @property
    def is_admin(self):
        """Check if user is admin."""
        return self.base_role in [MembershipRole.OWNER, MembershipRole.ADMIN]


class MembershipAuditLog(models.Model):
    """
    Audit log for membership changes.
    Tracks all changes to membership for compliance.
    """
    
    membership = models.ForeignKey(
        OrganizationMembership,
        on_delete=models.CASCADE,
        related_name='audit_logs'
    )
    
    ACTION_CHOICES = [
        ('created', _('Created')),
        ('role_changed', _('Role Changed')),
        ('status_changed', _('Status Changed')),
        ('suspended', _('Suspended')),
        ('reactivated', _('Reactivated')),
        ('left', _('Left Organization')),
        ('removed', _('Removed')),
    ]
    
    action = models.CharField(
        max_length=20,
        choices=ACTION_CHOICES,
        db_index=True
    )
    
    old_value = models.JSONField(null=True, blank=True)
    new_value = models.JSONField(null=True, blank=True)
    
    performed_by = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        related_name='membership_actions'
    )
    
    reason = models.TextField(blank=True)
    
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)
    
    class Meta:
        verbose_name = _("Membership Audit Log")
        verbose_name_plural = _("Membership Audit Logs")
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['membership', 'action']),
            models.Index(fields=['created_at']),
        ]
    
    def __str__(self):
        return f"{self.action} - {self.membership}"
```

---

## 5. Teams & Departments

**File: `users/models/team.py`**

```python
"""
Team and department models for organizing users.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _
from django.contrib.postgres.fields import ArrayField

from core.models import TenantModel
from core.validators import validate_slug
from users.constants import TeamType


class Team(TenantModel):
    """
    Teams for organizing users within an organization.
    Can represent departments, project teams, working groups, etc.
    """
    
    name = models.CharField(
        max_length=200,
        help_text=_("Team name")
    )
    
    slug = models.SlugField(
        max_length=100,
        validators=[validate_slug],
        help_text=_("URL-safe identifier")
    )
    
    description = models.TextField(
        blank=True,
        help_text=_("Team description and purpose")
    )
    
    team_type = models.CharField(
        max_length=20,
        choices=TeamType.choices,
        default=TeamType.CUSTOM,
        db_index=True
    )
    
    # Hierarchy
    parent_team = models.ForeignKey(
        'self',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='child_teams',
        help_text=_("Parent team for nested structure")
    )
    
    # Leadership
    team_lead = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='led_teams',
        help_text=_("Team leader/manager")
    )
    
    # Members (many-to-many through TeamMembership)
    members = models.ManyToManyField(
        'User',
        through='TeamMembership',
        related_name='teams',
        blank=True
    )
    
    # Settings
    is_public = models.BooleanField(
        default=True,
        help_text=_("Team is visible to all org members")
    )
    
    allow_self_join = models.BooleanField(
        default=False,
        help_text=_("Allow users to join without approval")
    )
    
    max_members = models.PositiveIntegerField(
        null=True,
        blank=True,
        help_text=_("Maximum team size (null = unlimited)")
    )
    
    # Contact
    email = models.EmailField(
        blank=True,
        help_text=_("Team email address")
    )
    
    # Visual
    color = models.CharField(
        max_length=7,
        default='#4F46E5',
        help_text=_("Team color (hex)")
    )
    
    icon = models.CharField(
        max_length=50,
        blank=True,
        help_text=_("Icon class or emoji")
    )
    
    avatar_url = models.URLField(
        blank=True,
        help_text=_("Team avatar/logo URL")
    )
    
    # Status
    is_active = models.BooleanField(
        default=True,
        db_index=True
    )
    
    archived_at = models.DateTimeField(null=True, blank=True)
    
    # Metadata
    tags = ArrayField(
        models.CharField(max_length=50),
        default=list,
        blank=True,
        help_text=_("Team tags for categorization")
    )
    
    custom_fields = models.JSONField(
        default=dict,
        blank=True
    )
    
    class Meta:
        verbose_name = _("Team")
        verbose_name_plural = _("Teams")
        unique_together = [
            ('tenant', 'slug'),
        ]
        indexes = [
            models.Index(fields=['tenant', 'is_active']),
            models.Index(fields=['team_type']),
            models.Index(fields=['parent_team']),
        ]
    
    def __str__(self):
        return self.name
    
    @property
    def member_count(self):
        """Get active member count."""
        return self.team_memberships.filter(is_active=True).count()
    
    @property
    def is_full(self):
        """Check if team has reached max capacity."""
        if not self.max_members:
            return False
        return self.member_count >= self.max_members
    
    def archive(self):
        """Archive team."""
        from django.utils import timezone
        self.is_active = False
        self.archived_at = timezone.now()
        self.save()
    
    def unarchive(self):
        """Unarchive team."""
        self.is_active = True
        self.archived_at = None
        self.save()


class TeamMembership(TenantModel):
    """
    Membership linking users to teams.
    """
    
    team = models.ForeignKey(
        Team,
        on_delete=models.CASCADE,
        related_name='team_memberships'
    )
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='team_memberships'
    )
    
    ROLE_CHOICES = [
        ('lead', _('Team Lead')),
        ('member', _('Member')),
        ('contributor', _('Contributor')),
    ]
    
    role = models.CharField(
        max_length=20,
        choices=ROLE_CHOICES,
        default='member',
        db_index=True
    )
    
    is_active = models.BooleanField(
        default=True,
        db_index=True
    )
    
    joined_at = models.DateTimeField(auto_now_add=True)
    left_at = models.DateTimeField(null=True, blank=True)
    
    added_by = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='added_team_members'
    )
    
    # Notifications
    receive_team_notifications = models.BooleanField(
        default=True,
        help_text=_("Receive notifications for team activities")
    )
    
    class Meta:
        verbose_name = _("Team Membership")
        verbose_name_plural = _("Team Memberships")
        unique_together = [
            ('team', 'user'),
        ]
        indexes = [
            models.Index(fields=['team', 'is_active']),
            models.Index(fields=['user', 'is_active']),
        ]
    
    def __str__(self):
        return f"{self.user.email} in {self.team.name}"
    
    def leave(self):
        """Leave team."""
        from django.utils import timezone
        self.is_active = False
        self.left_at = timezone.now()
        self.save()
```

---

## 6. Contact Information

**File: `users/models/contact.py`**

```python
"""
Additional contact information models.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _

from core.models import BaseModel
from core.models.fields import EncryptedCharField


class UserContactMethod(BaseModel):
    """
    Additional contact methods for users.
    Supports multiple emails, phones, etc.
    """
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='contact_methods'
    )
    
    CONTACT_TYPE_CHOICES = [
        ('email', _('Email')),
        ('phone', _('Phone')),
        ('mobile', _('Mobile')),
        ('fax', _('Fax')),
        ('address', _('Address')),
        ('other', _('Other')),
    ]
    
    contact_type = models.CharField(
        max_length=20,
        choices=CONTACT_TYPE_CHOICES,
        db_index=True
    )
    
    label = models.CharField(
        max_length=50,
        blank=True,
        help_text=_("Label (e.g., 'Work', 'Personal')")
    )
    
    value = EncryptedCharField(
        max_length=255,
        help_text=_("Contact value (email, phone, etc.)")
    )
    
    is_primary = models.BooleanField(
        default=False,
        help_text=_("Primary contact of this type")
    )
    
    is_verified = models.BooleanField(
        default=False,
        help_text=_("Whether contact is verified")
    )
    
    verified_at = models.DateTimeField(null=True, blank=True)
    
    # Visibility
    is_public = models.BooleanField(
        default=False,
        help_text=_("Show in public profile")
    )
    
    class Meta:
        verbose_name = _("User Contact Method")
        verbose_name_plural = _("User Contact Methods")
        indexes = [
            models.Index(fields=['user', 'contact_type']),
            models.Index(fields=['is_primary']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.contact_type}: {self.label or 'Unlabeled'}"
```

---

## 7. Social Profiles

**File: `users/models/social.py`**

```python
"""
Social media profiles and links.
"""

from django.db import models
from django.core.validators import URLValidator
from django.utils.translation import gettext_lazy as _

from core.models import BaseModel
from users.constants import SocialProvider


class UserSocialProfile(BaseModel):
    """
    Social media profiles and professional networks.
    """
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='social_profiles'
    )
    
    provider = models.CharField(
        max_length=20,
        choices=SocialProvider.choices,
        db_index=True
    )
    
    provider_user_id = models.CharField(
        max_length=255,
        blank=True,
        help_text=_("User ID on the provider platform")
    )
    
    username = models.CharField(
        max_length=255,
        blank=True,
        help_text=_("Username on the platform")
    )
    
    profile_url = models.URLField(
        validators=[URLValidator()],
        help_text=_("Link to profile")
    )
    
    is_verified = models.BooleanField(
        default=False,
        help_text=_("Whether we've verified ownership")
    )
    
    is_public = models.BooleanField(
        default=True,
        help_text=_("Show in public profile")
    )
    
    # OAuth tokens (encrypted, for integration features)
    access_token = models.TextField(
        blank=True,
        help_text=_("OAuth access token (encrypted)")
    )
    
    refresh_token = models.TextField(
        blank=True,
        help_text=_("OAuth refresh token (encrypted)")
    )
    
    token_expires_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        verbose_name = _("User Social Profile")
        verbose_name_plural = _("User Social Profiles")
        unique_together = [
            ('user', 'provider'),
        ]
        indexes = [
            models.Index(fields=['user', 'is_public']),
            models.Index(fields=['provider']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.provider}"


class UserLink(BaseModel):
    """
    Custom links for user profiles.
    """
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='links'
    )
    
    title = models.CharField(
        max_length=100,
        help_text=_("Link title/label")
    )
    
    url = models.URLField(
        validators=[URLValidator()],
        help_text=_("URL")
    )
    
    icon = models.CharField(
        max_length=50,
        blank=True,
        help_text=_("Icon class or emoji")
    )
    
    display_order = models.PositiveIntegerField(
        default=0,
        help_text=_("Display order")
    )
    
    is_public = models.BooleanField(
        default=True,
        help_text=_("Show in public profile")
    )
    
    class Meta:
        verbose_name = _("User Link")
        verbose_name_plural = _("User Links")
        ordering = ['display_order', 'title']
        indexes = [
            models.Index(fields=['user', 'is_public']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.title}"
```

---

## 8. Employment Details

**File: `users/models/employment.py`**

```python
"""
Employment and work history models.
"""

from django.db import models
from django.utils.translation import gettext_lazy as _

from core.models import TenantModel
from users.constants import EmploymentType


class EmploymentDetails(TenantModel):
    """
    Employment details for a user within an organization.
    """
    
    user = models.ForeignKey(
        'User',
        on_delete=models.CASCADE,
        related_name='employment_details'
    )
    
    # Note: tenant field is the organization
    
    # Employment Info
    employee_id = models.CharField(
        max_length=50,
        blank=True,
        db_index=True,
        help_text=_("Internal employee ID")
    )
    
    employment_type = models.CharField(
        max_length=20,
        choices=EmploymentType.choices,
        default=EmploymentType.FULL_TIME
    )
    
    job_title = models.CharField(max_length=200)
    department = models.CharField(max_length=100, blank=True)
    division = models.CharField(max_length=100, blank=True)
    
    # Reporting
    reports_to = models.ForeignKey(
        'User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='direct_reports',
        help_text=_("Direct manager")
    )
    
    # Dates
    start_date = models.DateField(
        help_text=_("Employment start date")
    )
    
    end_date = models.DateField(
        null=True,
        blank=True,
        help_text=_("Employment end date (if applicable)")
    )
    
    probation_end_date = models.DateField(
        null=True,
        blank=True,
        help_text=_("End of probation period")
    )
    
    # Work Schedule
    work_hours_per_week = models.DecimalField(
        max_digits=5,
        decimal_places=2,
        null=True,
        blank=True,
        help_text=_("Standard work hours per week")
    )
    
    work_location = models.CharField(
        max_length=20,
        default='office',
        choices=[
            ('office', _('Office')),
            ('remote', _('Remote')),
            ('hybrid', _('Hybrid')),
        ]
    )
    
    office_location = models.CharField(
        max_length=200,
        blank=True,
        help_text=_("Office/location name")
    )
    
    # Compensation (encrypted in real implementation)
    salary_currency = models.CharField(max_length=3, default='USD')
    
    # Status
    is_active = models.BooleanField(
        default=True,
        db_index=True
    )
    
    # Notes
    notes = models.TextField(
        blank=True,
        help_text=_("Internal notes")
    )
    
    class Meta:
        verbose_name = _("Employment Details")
        verbose_name_plural = _("Employment Details")
        unique_together = [
            ('tenant', 'user'),
        ]
        indexes = [
            models.Index(fields=['tenant', 'employee_id']),
            models.Index(fields=['tenant', 'is_active']),
        ]
    
    def __str__(self):
        return f"{self.user.email} - {self.job_title} at {self.tenant.name}"
```

---

## 9. Custom User Manager

**File: `users/managers/user.py`**

```python
"""
Custom user manager.
"""

from django.contrib.auth.models import BaseUserManager
from django.utils.translation import gettext_lazy as _


class UserManager(BaseUserManager):
    """
    Custom manager for User model.
    """
    
    def create_user(self, email, username, password=None, **extra_fields):
        """
        Create and save a regular user.
        """
        if not email:
            raise ValueError(_('Email address is required'))
        if not username:
            raise ValueError(_('Username is required'))
        
        email = self.normalize_email(email)
        user = self.model(
            email=email,
            username=username,
            **extra_fields
        )
        
        if password:
            user.set_password(password)
        else:
            user.set_unusable_password()
        
        user.save(using=self._db)
        return user
    
    def create_superuser(self, email, username, password=None, **extra_fields):
        """
        Create and save a superuser.
        """
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        extra_fields.setdefault('is_active', True)
        extra_fields.setdefault('email_verified', True)
        extra_fields.setdefault('status', 'active')
        
        if extra_fields.get('is_staff') is not True:
            raise ValueError(_('Superuser must have is_staff=True'))
        if extra_fields.get('is_superuser') is not True:
            raise ValueError(_('Superuser must have is_superuser=True'))
        
        return self.create_user(email, username, password, **extra_fields)
    
    def active(self):
        """Get active users."""
        return self.filter(is_active=True, is_deleted=False, status='active')
    
    def verified(self):
        """Get users with verified email."""
        return self.filter(email_verified=True)
    
    def staff(self):
        """Get staff users."""
        return self.filter(is_staff=True)
    
    def with_mfa(self):
        """Get users with MFA enabled."""
        return self.filter(mfa_enabled=True)
```

---

## 10. Models Package Initialization

**File: `users/models/__init__.py`**

```python
"""
Users models package.
"""

from .user import (
    User,
    UserVerification,
    UserActivity,
)

from .profile import (
    UserProfile,
    UserPreferences,
)

from .membership import (
    OrganizationMembership,
    MembershipAuditLog,
)

from .team import (
    Team,
    TeamMembership,
)

from .contact import (
    UserContactMethod,
)

from .social import (
    UserSocialProfile,
    UserLink,
)

from .employment import (
    EmploymentDetails,
)

__all__ = [
    # User
    'User',
    'UserVerification',
    'UserActivity',
    
    # Profile
    'UserProfile',
    'UserPreferences',
    
    # Membership
    'OrganizationMembership',
    'MembershipAuditLog',
    
    # Team
    'Team',
    'TeamMembership',
    
    # Contact
    'UserContactMethod',
    
    # Social
    'UserSocialProfile',
    'UserLink',
    
    # Employment
    'EmploymentDetails',
]
```

---

## 11. Django Settings Update

**File: `config/settings/base.py` (additions)**

```python
# Custom User Model
AUTH_USER_MODEL = 'users.User'

# Password Hashers (Argon2 for production)
PASSWORD_HASHERS = [
    'django.contrib.auth.hashers.Argon2PasswordHasher',
    'django.contrib.auth.hashers.PBKDF2PasswordHasher',
    'django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher',
    'django.contrib.auth.hashers.BCryptSHA256PasswordHasher',
]

# Add to INSTALLED_APPS
INSTALLED_APPS = [
    # ... existing apps ...
    'users.apps.UsersConfig',
]
```

---

## 12. Signal Handlers (Auto-create profiles)

**File: `users/signals.py`**

```python
"""
Signal handlers for user model.
"""

from django.db.models.signals import post_save
from django.dispatch import receiver

from users.models import User, UserProfile, UserPreferences


@receiver(post_save, sender=User)
def create_user_profile(sender, instance, created, **kwargs):
    """
    Automatically create UserProfile and UserPreferences when User is created.
    """
    if created:
        UserProfile.objects.create(user=instance)
        UserPreferences.objects.create(user=instance)


@receiver(post_save, sender=User)
def save_user_profile(sender, instance, **kwargs):
    """
    Save profile when user is saved.
    """
    if hasattr(instance, 'profile'):
        instance.profile.save()
    if hasattr(instance, 'preferences'):
        instance.preferences.save()
```

**File: `users/apps.py`**

```python
"""
Users application configuration.
"""

from django.apps import AppConfig


class UsersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'users'
    verbose_name = 'Users'
    
    def ready(self):
        """Import signals when app is ready."""
        import users.signals  # noqa
```

---

## Phase 3 Summary

### What We've Built

✅ **Custom User Model** - Production-ready authentication foundation
- UUID primary keys for security
- Case-insensitive email/username
- Comprehensive status management (active, suspended, locked, etc.)
- Email verification workflow
- MFA support flags
- Security tracking (login attempts, IP addresses)
- Soft deletion support
- Activity tracking

✅ **User Profiles** - Rich user information
- Extended personal details
- Contact information
- Professional details
- Skills and interests
- Emergency contacts
- Privacy controls
- Custom fields for flexibility

✅ **User Preferences** - Personalization
- Theme and appearance settings
- Notification preferences (email, push, SMS, in-app)
- Digest frequency options
- Display preferences
- Accessibility settings
- Developer mode and beta features

✅ **Organization Membership** - Multi-tenancy links
- Links users to organizations
- Role-based access (owner, admin, member, guest)
- Status management (active, suspended, left)
- Default organization support
- Job/position tracking
- Audit logging for compliance

✅ **Teams & Departments** - Organization structure
- Hierarchical team structure
- Team types (department, project, working group)
- Team leadership
- Member roles within teams
- Visibility and join settings
- Team capacity limits

✅ **Additional Features**
- Multiple contact methods per user
- Social profile integration (GitHub, LinkedIn, etc.)
- Custom links for profiles
- Employment details tracking
- Verification system for emails/phones
- User activity logging

### Key Security Features

- **Argon2 Password Hashing**: Industry-leading password security
- **Account Lockout**: Brute force protection with configurable attempts
- **Email Verification**: Required before full account activation
- **IP Tracking**: Login and activity monitoring
- **Status Management**: Multiple account states for compliance
- **Soft Deletion**: Data retention for audit purposes
- **Encrypted Fields**: Sensitive data protection

### Database Design Highlights

- **Optimized Indexes**: Fast lookups on email, username, status
- **Composite Indexes**: Efficient multi-tenant queries
- **Unique Constraints**: Data integrity enforcement
- **Foreign Key Protection**: PROTECT on critical relationships
- **JSON Fields**: Flexible metadata without schema changes

### Multi-Tenancy Support

- Organization membership with role hierarchy
- Default organization per user
- Access tracking per organization
- Tenant-scoped team memberships
- Employment details per organization

---

## Next Steps

**Phase 3 Complete! ✓**

The user identity system is now fully established with comprehensive profile management, multi-organization support, and team structures.

Ready to proceed with **Phase 4: Authentication System**?

This will include:
- Password authentication with Argon2
- OAuth 2.0 / Social authentication
- SAML 2.0 SSO
- OpenID Connect (OIDC)
- Multi-Factor Authentication (TOTP, SMS, Email, Hardware Keys)
- Passkeys / WebAuthn / FIDO2
- Magic Links / Passwordless
- API Keys & Personal Access Tokens
- Service Accounts
- Session management & device tracking
- mTLS / Certificate-based authentication
- Password policies & security rules

Reply with **"Proceed with Phase 4"** to continue!
